image: docker:19.03.0

stages:
  - pre-build
  - build
  - test
  - deploy

build-docker:
    services:
    - docker:19.03.0-dind

    before_script:
    - docker info
    - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD

    stage: pre-build
    script:
    - docker build -t minha-imagem .
    - docker tag minha-imagem 272001/minha-imagem:latest
    - docker push 272001/minha-imagem:latest

build-project:
    stage: build
    tags:
    - executor-tarefas
    dependencies:
      - build-docker
    script:
    - echo "runner"
